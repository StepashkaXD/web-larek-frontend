# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/types/ — типы данных
- src/utils/ — утилиты
- src/scss/ — стили

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Об архитектуре

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

## Архитектура проекта

Архитектура проекта основана на MVP-паттерне с использованием брокера событий для взаимодействия между частями приложения. Основные части архитектуры включают Модели данных, Представления (Компоненты) и Связующий слой (логика приложения, управляемая событиями).

### Основные компоненты и их назначение

1.  **Модели данных**: Отвечают за хранение и управление состоянием данных приложения, а также бизнес-логику.
2.  **Представления (Компоненты)**: Отвечают за отображение данных пользователю и обработку его действий.
3.  **Брокер событий**: Обеспечивает слабую связанность между компонентами, позволяя им взаимодействовать путем подписки на события и их публикации.
4.  **API Клиент**: Отвечает за взаимодействие с внешним API для получения и отправки данных.

### Взаимодействие компонентов

Взаимодействие происходит преимущественно через брокер событий (`IEventEmitter`). Модели данных (`IProductModel`, `ICartModel`, `IOrderModel`) могут инициировать события при изменении своего состояния (например, 'cart:updated'). Компоненты (`ProductCard`, `CartModal`, `OrderFormModal`) могут подписываться на эти события, чтобы обновить свое отображение. Компоненты также могут вызывать методы моделей напрямую для выполнения действий (например, добавить товар в корзину). API Клиент (`IApiClient`) используется моделями для запросов к серверу.

Процессы в приложении (например, добавление товара в корзину, оформление заказа) реализуются путем вызова соответствующих методов моделей, которые в свою очередь используют API Клиент и инициируют события для обновления представлений.

### Данные, используемые в приложении и их описание

Проект работает со следующими основными типами данных, определенными в `src/types/index.ts`:

*   `IProductItem`: Интерфейс, описывающий структуру данных одного товара, получаемых или используемых в приложении.
    *   `id: string`: Уникальный идентификатор товара.
    *   `description: string`: Подробное описание товара.
    *   `image: string`: URL изображения товара.
    *   `title: string`: Название товара.
    *   `category: string`: Категория товара.
    *   `price: number | null`: Цена товара. Может быть `null`, если товар недоступен для покупки.

*   `IProductList`: Интерфейс, описывающий ответ API при запросе списка товаров.
    *   `total: number`: Общее количество товаров.
    *   `items: IProductItem[]`: Массив товаров.

*   `ICartItem`: Интерфейс, описывающий отдельный элемент в корзине.
    *   `product: IProductItem`: Сам товар.
    *   `quantity: number`: Количество данного товара в корзине.

*   `ICart`: Интерфейс, описывающий состояние корзины.
    *   `items: ICartItem[]`: Массив элементов корзины.
    *   `total: number`: Общая стоимость товаров в корзине.

*   `IOrderForm`: Интерфейс, описывающий данные формы заказа на первом и втором шагах оформления.
    *   `payment?: string`: Выбранный способ оплаты (опционально до выбора).
    *   `address?: string`: Адрес доставки (опционально до ввода).
    *   `phone?: string`: Телефон покупателя (опционально до ввода).
    *   `email?: string`: Email покупателя (опционально до ввода).
    *   `total?: string | number`: Общая стоимость заказа (опционально, может быть строкой или числом).

*   `IOrder`: Интерфейс, описывающий структуру заказа после его создания (наследует от `IOrderForm`).
    *   Наследует все свойства от `IOrderForm`.
    *   `items: string[]`: Массив идентификаторов товаров в заказе.

*   `IOrderLot`: Интерфейс, описывающий полные данные заказа для отправки на сервер.
    *   `payment: string`: Выбранный способ оплаты.
    *   `email: string`: Email покупателя.
    *   `phone: string`: Телефон покупателя.
    *   `address: string`: Адрес доставки.
    *   `total: number`: Общая стоимость заказа.
    *   `items: string[]`: Массив идентификаторов товаров в заказе.

*   `IOrderResult`: Интерфейс, описывающий структуру ответа сервера после успешного создания заказа.
    *   `id: string`: Идентификатор созданного заказа.
    *   `total: number`: Подтвержденная сервером общая стоимость заказа.

*   `IOrderError`: Интерфейс, описывающий структуру ответа сервера при ошибке создания заказа.
    *   `error: string`: Сообщение об ошибке.

### Описание основных интерфейсов и классов

*   `<<interface>> IComponent`: Базовый интерфейс для всех визуальных компонентов приложения.
    *   **Назначение:** Определяет базовый контракт для элементов пользовательского интерфейса, которые могут быть отображены и, возможно, удалены.
    *   **Методы:**
        *   `render(): HTMLElement`: Метод для создания или обновления DOM-элемента компонента. Возвращает корневой HTMLElement компонента.
        *   `destroy(): void`: Метод для очистки ресурсов, связанных с компонентом (например, удаление обработчиков событий, удаление из DOM).

*   `<<interface>> IModal extends IComponent`: Интерфейс для модальных окон, наследующий от `IComponent`.
    *   **Назначение:** Определяет контракт для компонентов, которые функционируют как модальные окна (могут открываться и закрываться).
    *   **Методы:**
        *   `open(): void`: Метод для отображения модального окна на экране.
        *   `close(): void`: Метод для скрытия или удаления модального окна с экрана.
    *   Наследует методы `render()` и `destroy()` от `IComponent`.

*   `<<interface>> IActions`: Интерфейс для определения действий, которые могут быть привязаны к элементам пользовательского интерфейса.
    *   **Назначение:** Позволяет типизировать обработчики событий, чаще всего кликов, передаваемых компонентам.
    *   **Методы:**
        *   `onClick(event: MouseEvent): void`: Метод-обработчик события клика мышью.

*   `<<interface>> IEventEmitter`: Интерфейс брокера событий.
    *   **Назначение:** Обеспечивает механизм публикации-подписки для обмена сообщениями (событиями) между слабосвязанными частями приложения.
    *   **Методы:**
        *   `on(event: string, callback: EventCallback): void`: Подписывает обработчик `callback` на событие с именем `event`. `callback` будет вызван при возникновении события.
        *   `off(event: string, callback: EventCallback): void`: Отписывает обработчик `callback` от события `event`.
        *   `emit(event: string, ...args: any[]): void`: Публикует событие с именем `event`, передавая дополнительные аргументы `...args` всем подписанным обработчикам.

*   `EventCallback`: Тип для функций-обработчиков событий.
    *   **Назначение:** Определяет сигнатуру функции, которая может быть использована как обработчик события.
    *   **Сигнатура:** `(...args: any[]) => void`: Функция, принимающая любое количество аргументов и не возвращающая значения.

*   `<<interface>> ApiResponse<T>`: Интерфейс, описывающий стандартную структуру ответа от API.
    *   **Назначение:** Типизирует ответы от сервера, позволяя единообразно обрабатывать успешные данные, ошибки и статус запроса.
    *   **Свойства:**
        *   `success: boolean`: Индикатор успешности выполнения запроса.
        *   `data?: T`: Опциональное поле с данными ответа в случае успеха. Типизируется с помощью дженерика `T`.
        *   `error?: string`: Опциональное поле с сообщением об ошибке в случае неудачи.

*   `<<interface>> IApiClient`: Интерфейс клиента для взаимодействия с API сервера.
    *   **Назначение:** Предоставляет стандартизированные методы для выполнения HTTP-запросов к внешнему API.
    *   **Методы:**
        *   `get<T>(endpoint: string): Promise<ApiResponse<T>>`: Выполняет GET-запрос к указанной конечной точке API. Возвращает Promise, который разрешается с типизированным ответом `ApiResponse<T>`.
        *   `post<T>(endpoint: string, data: any): Promise<ApiResponse<T>>`: Выполняет POST-запрос к указанной конечной точке с телом запроса `data`. Возвращает Promise с типизированным ответом.
        *   `put<T>(endpoint: string, data: any): Promise<ApiResponse<T>>`: Выполняет PUT-запрос.
        *   `delete<T>(endpoint: string): Promise<ApiResponse<T>>`: Выполняет DELETE-запрос.

*   `<<interface>> IProductModel`: Интерфейс модели данных для работы с товарами.
    *   **Назначение:** Отвечает за получение списка товаров и информации о конкретном товаре.
    *   **Методы:**
        *   `getProducts(): Promise<IProductList>`: Асинхронно получает список всех товаров с информацией о пагинации. Возвращает Promise, разрешающийся объектом `IProductList`.
        *   `getProduct(id: string): Promise<IProductItem>`: Асинхронно получает данные конкретного товара по его `id`. Возвращает Promise, разрешающийся объектом `IProductItem`.

*   `<<interface>> ICartModel`: Интерфейс модели данных для работы с корзиной.
    *   **Назначение:** Управляет состоянием корзины: добавлением, удалением товаров, расчетом общей стоимости.
    *   **Методы:**
        *   `getCart(): ICart`: Возвращает текущее состояние корзины в виде объекта `ICart`.
        *   `addToCart(product: IProductItem): void`: Добавляет указанный `product` в корзину. Инициирует событие 'cart:updated'.
        *   `removeFromCart(productId: string): void`: Удаляет товар с указанным `productId` из корзины. Инициирует событие 'cart:updated'.
        *   `clearCart(): void`: Полностью очищает корзину. Инициирует событие 'cart:updated'.

*   `<<interface>> IOrderModel`: Интерфейс модели данных для работы с заказами.
    *   **Назначение:** Отвечает за создание нового заказа и, возможно, получение списка существующих заказов.
    *   **Методы:**
        *   `createOrder(form: IOrderLot): Promise<IOrderResult>`: Асинхронно создает новый заказ, используя данные из формы `form`. Отправляет данные на сервер через API. Возвращает Promise, разрешающийся результатом создания заказа `IOrderResult`.
        *   `getOrders(): Promise<IOrder[]>`: Асинхронно получает список существующих заказов. Возвращает Promise, разрешающийся массивом `IOrder`.

### Описание классов компонентов (Представления)

*   `ProductCard`: Класс, представляющий визуальный компонент карточки товара.
    *   **Назначение:** Отображает информацию о товаре (название, цена, категория, изображение) и предоставляет функционал для взаимодействия (клик для просмотра деталей, кнопка добавления в корзину).
    *   **Конструктор:**
        *   Принимает `HTMLElement` - корневой DOM-элемент для компонента.
        *   Принимает объект с данными товара типа `IProductItem`.
        *   Принимает объект с действиями типа `IActions` для обработки кликов.
    *   **Свойства:** Может иметь свойства для ссылок на DOM-элементы внутри карточки (`_titleElement`, `_priceElement` и т.п.) и ссылку на объект данных товара (`_productData`).
    *   **Методы/Сеттеры:** Могут включать методы для обновления отображения карточки (`set productData(data: IProductItem)`), привязки обработчиков событий.
    *   Реализует интерфейс `IComponent` (методы `render`, `destroy`).

*   `CartModal`: Класс, представляющий визуальный компонент модального окна корзины.
    *   **Назначение:** Отображает список товаров в корзине, их количество и общую стоимость. Предоставляет функционал для изменения количества, удаления товаров и перехода к оформлению заказа.
    *   **Конструктор:**
        *   Принимает `HTMLElement` - корневой DOM-элемент модального окна.
        *   Может принимать ссылку на объект модели корзины (`ICartModel`) или брокер событий (`IEventEmitter`) для получения данных и взаимодействия.
    *   **Свойства:** Может иметь свойства для ссылок на DOM-элементы списка товаров, общей стоимости, кнопки оформления.
    *   **Методы/Сеттеры:** Методы для обновления списка товаров (`updateItems(items: ICartItem[])`), обновления общей стоимости (`updateTotal(total: number)`). Реализует интерфейс `IModal` (методы `open`, `close`).

*   `OrderFormModal`: Класс, представляющий визуальный компонент модального окна с формами оформления заказа.
    *   **Назначение:** Отображает шаги оформления заказа (выбор оплаты/адреса, ввод контактов), собирает данные от пользователя, выполняет валидацию и инициирует процесс создания заказа.
    *   **Конструктор:**
        *   Принимает `HTMLElement` - корневой DOM-элемент модального окна.
        *   Может принимать ссылку на объект модели заказа (`IOrderModel`) или брокер событий (`IEventEmitter`) для взаимодействия.
    *   **Свойства:** Может иметь свойства для ссылок на DOM-элементы полей ввода, кнопок, сообщений об ошибках.
    *   **Методы/Сеттеры:** Методы для отображения текущего шага (`showStep(step: number)`), сбора данных формы (`get formData(): IOrderForm`), валидации полей (`validate(): boolean`), отображения ошибок (`showErrors(errors: string[])`). Реализует интерфейс `IModal` (методы `open`, `close`).

## UML Диаграмма Архитектуры

![UML Диаграмма Архитектуры](web-larek-uml-diagram.png)

## Исходная схема-набросок

![Исходная схема-набросок](excalidraw.png)

## Основные Типы и Интерфейсы Проекта

Ниже перечислены основные типы и интерфейсы, определенные в `src/types/index.ts`:

*   `IProductItem`
*   `IProductList`
*   `IActions`
*   `IOrderForm`
*   `IOrder`
*   `IOrderLot`
*   `IOrderResult`
*   `IOrderError`
*   `ICartItem`
*   `ICart`
*   `IComponent`
*   `IModal`
*   `IEventEmitter`
*   `EventCallback`
*   `IApiClient`
*   `ApiResponse<T>`
*   `IProductModel`
*   `ICartModel`
*   `IOrderModel`

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```

## Сборка

```
npm run build
```

или

```
yarn build
```
